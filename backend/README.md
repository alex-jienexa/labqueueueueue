## Сторона бекенда

API доступно по адресу 127.0.0.1:8080 (по умолчанию).
Все методы, кроме `register`, `login` и `ping` требуют содержания JWT-токена в заголовке запроса.
Этот JWT-токен можно получить с помощью успешного выполнения `login`, так что лучше хранить его где-то во фронтенде.
Использовать JWT-токен надо в заголовке запроса:
```
curl -X GET http://localhost:8080/queues/active \
  -H "Authorization: JWT-токен-здесь"
```

### Объекты, возвращаемые в методах

Все поля содержат идентификатор `ID`, под которым они хранятся в базе данных.

`Student` - объект пользователя системы, который представляет студента. 

**Поля:**
- `name` - Имя студента.
- `surname` - Фамилия студента.
- `is_admin` - Флаг, который отвечает за то, является ли пользователем администратором системы. Здесь, старостой является староста системы, но это никак не контролируется - любой может создать пользователя с админ-правами.
- `username` - Логин студента. Используется для логина в систему.
- `password` - Пароль для аутентификации в ситему. В базе данных пароль хранится в зашифрованном виде, который был зашифрован с помощью `bcrypt.GenerateFromPassword` (см. `api/auth.go` для подробностей). В JSON-модели (см. `models/student.go`) *не указан* JSON-плейсхолдер для пароля:
```golang
type User struct {
    // ...
    Password string `json:"-"` //<- по умолчанию там должен быть ключ
}
```
Это говорит о том, что пароль невозможно получить в JSON формат и **нельзя получить из JSON**, значит а значит конструкция `c.ShouldBindJSON(&models.Student);` не заполнит значение пароля - для этого необходимо создать отдельную кострукцию для вводимых значений:
```golang
var input struct {
		Username string `json:"username"`
		Password string `json:"password"`
	}

c.ShouldBindJSON(&input);
hashedPassword, err := bcrypt.GenerateFromPassword([]byte(input.Password), bcrypt.DefaultCost)

student := models.Student{
    //...
    Password: string(hashedPassword)
}
```

`Queue` - объект очереди в системе. Объект не содержит максимальное количество пользователей в очереди.

- `admin_id` - значение поля `ID` пользователя `Student`, который считается администратором очереди. Заполняется автоматически при создании нового объекта очереди - вставляется `ID` пользователя, создающего очередь.
- `title` - Название очереди
- `is_active` - Является ли очередь активной = можно ли в неё записаться или нет. Очередь будет считаться активной тогда, когда текущее время будет в промежутках между `starts_at` и `ends_at` (см. далее).
- `starts_at` - Содержит время в стандартном формате передачи времени в JSON. Отвечает за время начала записи в очередь.
- `ends_at` - То же, что и предыдущая переменная, но отвечает за время окончания записи в очередь.
- `resolution_method` - отвечает за то, что будет происходить с пользователем, который "проиграл" в конфликтной ситуации - как именно он будет перемещаться по очереди. Принимает текстовые настройки, однако ввод любого текста, кроме тех, что перечислены ниже, вызовут ошибку. 
    - `"move_after"` - АКА "после тебя тогда значит", проигравший конфликт перемещается на позицию, следующую за конфликтной, перемещая всех пользователей далее на 1 позицию назад, при условии что он после перемещения попадёт на занятую позицию.
    - `"first_free"` - АКА "в конец очереди", проигравший конфликт перемещается в первый свободный слот очереди после конфликтного. 
    - `"to_end"` - АКА "ливай с позором", проигравший конфликт перемещается на.. далеко (1000+ позицию). Если в этом далёком позиции также есть человек, то он попадёт в первый свободный слот после него.
- `created_at` - Отвечает за время создания очереди. Заполняется автоматически при создании очереди.

### Методы в API

- `GET /ping` - понг. Используется для проверки бекенда.
- `POST /register` - Регистрация пользователя. В ответ возвращает созданного пользователя в базе данных. Принимает следующие поля. 
    - `name` - имя пользователя
    - `surname` - фамилия пользователя
    - `username` - логин для входа в систему
    - `password` - пароль для входа в систему
    - `is_admin` - булевый флаг, отвечающий за то является ли регистрируемый пользователь админитратором/старостой. 
- `POST /login` - Вход пользователя в систему. В ответ возвращает JWT-токен, который будет требоваться для всех дальнейших действий. Принимает следующие поля:
    - `username` - логин для входа в систему
    - `password` - пароль для входа в систему.

**Дальнейшие методы требуют JWT-токен в заголовке:**
- `GET /rping` - тот же пинг, только под защитой JWT-токена. Используется для тестирования доступа к методам через использование токенов.
- `POST /queues` - создание очереди. Только пользователь с `IsAdmin = true` может это делать. В результате возвращается объект `Queue` созданной очереди. Принимает следующие поля:
    - `title` - название очереди
    - `starts_at` - время начала приёма записи в очередь
    - `ends_at` - время окончания приёма записи в очередь
    - `resolution_method` - метод поведения с пользователями в конфликтной ситуации. Может принимать только значения: `"move_after"` ("после тебя тогда значит"), `"first_free"` ("в конец очереди"), `"to_end"` ("ливай с позором").
- `GET /queues` - получить все очереди, которые есть в системе. Возвращает в ответ массив из объектов очередей.
- `GET /queues/active` - возвращает активную очередь. Активной очередью является та, в которую возможна запись, то есть текущее время находится в промежутке между `Queue.starts_at` и `Queue.ends_at`.
- `GET /queues/:id` - получает подробную информацию об очереди по её ID. 
- `PUT /queues/:id` - добавляет студента, *от чьего имени был отправлен запрос* (проверяется JWT-токеном) в очередь `id`. Возвращает объект позиции в очереди `QueueEntry` после успешного помещения студента в очереди. В теле запроса принимает только числовой аргумент `position`. Если `position = 0`, то студент будет помещён в первое свободное место в очереди. Иначе, он будет в указанном месте с вызовом конфликтных ситуаций. Метод также обновляет конфликтные ситуации каждого студента в позиции `position`.